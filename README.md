# Rails 5 Sample Swagger App

This repo is a sample of how to build up an Rail 5 API application and have Swagger Docs/UI document the API.

### Requirements

 * Ruby version: 2.4.*
 * Rails version: 5.1.*

 If you don't have these versions then run the following commands:

 ```
# when using rbenv
$ rbenv install 2.3.1
# set 2.3.1 as the global version
$ rbenv global 2.3.1
# install the right version of rails
$ gem install rails -v 5.1.4 --no-rdoc --no-ri
 ```

```
# when using rvm
$ rvm install 2.3.1
# set 2.3.1 as the global version
$ rvm use 2.3.1
# install the right version of rails
$ gem install rails -v 5.1.4 --no-rdoc --no-ri
```

## Build Rails 5 API application

This instruction is given based on the idea that users already have some experiences building Rails apps before. This will not go into details of how to build a Rails 5 API. Here is a really good tutorial though: https://scotch.io/tutorials/build-a-restful-json-api-with-rails-5-part-one

First create a new Rails 5 API app by running the following command:

```
$ rails new RailsSwaggerExample --api
$ bundle install
```

This will create a template api application assuming that each endpoint will return some sort of JSON object.

Let just say we want to build a simple BookManager application with just Books and Authors. Generate models and controllers as you have with a normal rails app.

Click here to see the author model and controller.

The controller may look a little different than the usual rails application since everything should just return a JSON response. This is why the reponse.rb and Response module was created to make this easier.

Once you created your API check that each endpoint works the way you want it, either using the browser or curl.


## Swagger Docs/UI

Swagger is broken up into 2 parts in Rails. Swagger Docs is just the autogenerated json files that represents/documents your api. Then there is the Swagger UI which intakes the json files and outputs some nice html/css/javascript static pages for your web application. 

### Integrate Swagger Docs for Documentation

#### Add the right gem

First of all you will need this gem by including this in your Gemfile and then run bundle install:

```
gem 'swagger-docs'
```

This gem will automatically generate the right JSON files to help document your API if provided the right things. The documentation for the application is here: https://github.com/richhollis/swagger-docs

#### Create the initializer

Next you will need to create an initializer for the gem. This will tell the gem some basica information about your application and how to generate the JSON for your API.

```
# config/initializers/swagger_docs.rb

class Swagger::Docs::Config
  def self.transform_path(path, api_version)
    # Make a distinction between the APIs and API documentation paths.
    "apidocs/#{path}"
  end
end

Swagger::Docs::Config.base_api_controller = ActionController::API 

Swagger::Docs::Config.register_apis({
  "1.0" => {
    # the extension used for the API
    :api_extension_type => :json,
    # the output location where your .json files are written to
    :api_file_path => "public/apidocs",
    # the URL base path to your API
    :base_path => "",
    # if you want to delete all .json files at each generation
    :clean_directory => false,
    # add custom attributes to api-docs
    :attributes => {
      :info => {
        "title" => "Sample Swagger BookManager",
        "description" => "Uses swagger ui and docs to document BookManager API"
      }
    }
  }
})
```
